<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GeoGuessr Replica</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
}

#pano {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#guess-map {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 360px;
    height: 240px;
    border-radius: 12px;
    border: 4px solid #fff;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    z-index: 5;
    transition: all 0.3s ease;
}

#guess-map:hover {
    width: 520px;
    height: 380px;
}

#ui {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 10;
    background: rgba(255,255,255,0.96);
    padding: 20px 24px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    min-width: 280px;
}

#ui h2 {
    margin: 0 0 12px 0;
    color: #333;
    font-size: 24px;
}

#score {
    font-size: 18px;
    font-weight: bold;
    color: #2196F3;
    margin-bottom: 12px;
}

#round {
    font-size: 14px;
    color: #666;
    margin-bottom: 12px;
}

#status {
    margin-bottom: 14px;
    font-size: 15px;
    color: #555;
    min-height: 20px;
}

.btn-container {
    display: flex;
    gap: 8px;
}

button {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.2s;
}

#guessBtn { 
    background: #4CAF50; 
    color: white;
    flex: 1;
}

#guessBtn:hover { 
    background: #45a049;
    transform: translateY(-2px);
}

#guessBtn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none;
}

#nextBtn {
    background: #2196F3;
    color: white;
    flex: 1;
    display: none;
}

#nextBtn:hover {
    background: #0b7dda;
    transform: translateY(-2px);
}

#resetBtn { 
    background: #f44336; 
    color: white;
}

#resetBtn:hover { 
    background: #da190b;
    transform: translateY(-2px);
}

.line {
    position: absolute;
    z-index: 4;
    pointer-events: none;
}
</style>
</head>
<body>

<div id="ui">
    <h2>üåç GeoGuessr</h2>
    <div id="score">Score: 0</div>
    <div id="round">Round: 1/5</div>
    <div id="status">Click on the map to place your guess</div>
    <div class="btn-container">
        <button id="guessBtn">MAKE GUESS</button>
        <button id="nextBtn" style="display: none;">NEXT ROUND</button>
        <button id="resetBtn">NEW GAME</button>
    </div>
</div>

<div id="pano"></div>
<div id="guess-map"></div>

<script>
let panorama;
let miniMap;
let marker = null;
let answerMarker = null;
let targetLocation;
let currentRound = 1;
let totalScore = 0;
let polyline = null;

const locations = [
    { lat: 48.8584, lng: 2.2945, name: "Paris, France" },
    { lat: 40.7580, lng: -73.9855, name: "Times Square, New York" },
    { lat: 35.6762, lng: 139.6503, name: "Tokyo, Japan" },
    { lat: -22.9519, lng: -43.2105, name: "Rio de Janeiro, Brazil" },
    { lat: 51.5074, lng: -0.1278, name: "London, UK" },
    { lat: -33.8688, lng: 151.2093, name: "Sydney, Australia" },
    { lat: 55.7558, lng: 37.6173, name: "Moscow, Russia" },
    { lat: 41.9028, lng: 12.4964, name: "Rome, Italy" },
    { lat: 37.7749, lng: -122.4194, name: "San Francisco, USA" },
    { lat: 52.5200, lng: 13.4050, name: "Berlin, Germany" },
    { lat: 19.4326, lng: -99.1332, name: "Mexico City, Mexico" },
    { lat: 1.3521, lng: 103.8198, name: "Singapore" },
    { lat: 25.2048, lng: 55.2708, name: "Dubai, UAE" },
    { lat: -34.6037, lng: -58.3816, name: "Buenos Aires, Argentina" },
    { lat: 59.9139, lng: 10.7522, name: "Oslo, Norway" }
];

let usedLocations = [];

function getRandomLocation() {
    let availableLocations = locations.filter(loc => !usedLocations.includes(loc));
    if (availableLocations.length === 0) {
        usedLocations = [];
        availableLocations = locations;
    }
    const randomLoc = availableLocations[Math.floor(Math.random() * availableLocations.length)];
    usedLocations.push(randomLoc);
    return randomLoc;
}

function initRound() {
    if (marker) marker.setMap(null);
    if (answerMarker) answerMarker.setMap(null);
    if (polyline) polyline.setMap(null);
    marker = null;

    targetLocation = getRandomLocation();

    if (!panorama) {
        panorama = new google.maps.StreetViewPanorama(
            document.getElementById("pano"), {
                position: targetLocation,
                pov: { heading: 0, pitch: 0 },
                zoom: 1,
                addressControl: false,
                showRoadLabels: false,
                fullscreenControl: false,
                linksControl: true,
                panControl: true,
                zoomControl: true
            }
        );
    } else {
        panorama.setPosition(targetLocation);
        panorama.setPov({ heading: 0, pitch: 0 });
    }

    if (!miniMap) {
        miniMap = new google.maps.Map(document.getElementById("guess-map"), {
            center: { lat: 20, lng: 0 },
            zoom: 2,
            mapTypeId: "roadmap",
            streetViewControl: false,
            fullscreenControl: false,
            mapTypeControl: false
        });

        miniMap.addListener("click", (e) => {
            if (marker) marker.setMap(null);
            marker = new google.maps.Marker({
                position: e.latLng,
                map: miniMap,
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                }
            });
        });
    } else {
        miniMap.setCenter({ lat: 20, lng: 0 });
        miniMap.setZoom(2);
    }

    document.getElementById("guessBtn").style.display = "block";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("guessBtn").disabled = false;
    document.getElementById("status").innerText = "Click on the map to place your guess";
    document.getElementById("round").innerText = `Round: ${currentRound}/5`;
}

function calculateScore(distance) {
    const maxDistance = 20000000;
    const score = Math.max(0, 5000 * (1 - distance / maxDistance));
    return Math.round(score);
}

function checkGuess() {
    if (!marker) {
        alert("Please place a marker on the map first!");
        return;
    }

    document.getElementById("guessBtn").disabled = true;

    const guessPos = marker.getPosition();
    const answerPos = new google.maps.LatLng(targetLocation.lat, targetLocation.lng);

    const distance = google.maps.geometry.spherical.computeDistanceBetween(guessPos, answerPos);
    const roundScore = calculateScore(distance);
    totalScore += roundScore;

    answerMarker = new google.maps.Marker({
        position: answerPos,
        map: miniMap,
        icon: {
            url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
        }
    });

    polyline = new google.maps.Polyline({
        path: [guessPos, answerPos],
        geodesic: true,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 3,
        map: miniMap
    });

    const bounds = new google.maps.LatLngBounds();
    bounds.extend(guessPos);
    bounds.extend(answerPos);
    miniMap.fitBounds(bounds);

    document.getElementById("status").innerHTML = 
        `üìç ${targetLocation.name}<br>` +
        `üìè Distance: ${(distance / 1000).toFixed(2)} km<br>` +
        `‚≠ê Round Score: ${roundScore.toFixed(0)} points`;
    
    document.getElementById("score").innerText = `Score: ${totalScore.toFixed(0)}`;

    if (currentRound < 5) {
        document.getElementById("nextBtn").style.display = "block";
        document.getElementById("guessBtn").style.display = "none";
    } else {
        document.getElementById("status").innerHTML += 
            `<br><br>üéâ Game Over! Final Score: ${totalScore.toFixed(0)}/25000`;
        document.getElementById("nextBtn").style.display = "none";
    }
}

function nextRound() {
    currentRound++;
    initRound();
}

function resetGame() {
    currentRound = 1;
    totalScore = 0;
    usedLocations = [];
    document.getElementById("score").innerText = "Score: 0";
    initRound();
}

document.getElementById("guessBtn").addEventListener("click", checkGuess);
document.getElementById("nextBtn").addEventListener("click", nextRound);
document.getElementById("resetBtn").addEventListener("click", resetGame);

function initGame() {
    initRound();
}
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=geometry&callback=initGame">
</script>

</body>
</html>
